<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Smart Plant Monitor</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body{
  font-family:Arial;
  background:#111;
  color:white;
  text-align:center;
}
.card{
  background:#1e1e1e;
  padding:20px;
  margin:15px auto;
  width:300px;
  border-radius:15px;
}
.big{
  font-size:30px;
  font-weight:bold;
}
button{
  padding:12px 20px;
  margin:10px;
  border:none;
  border-radius:10px;
  font-size:16px;
  cursor:pointer;
}
.on{background:#00c853;color:white;}
.off{background:#d50000;color:white;}
</style>

</head>
<body>

<h2>ðŸŒ± Smart Plant Monitor</h2>

<div class="card">
<h3>ðŸ’§ Soil Moisture</h3>
<div id="soil" class="big">-- %</div>
</div>

<div class="card">
<h3>ðŸŒ¡ Temperature</h3>
<div id="temp" class="big">-- Â°C</div>
</div>

<div class="card">
<h3>ðŸš¨ Alarm Status</h3>
<div id="alarm" class="big">--</div>
</div>

<div class="card">
<h3>ðŸŽ› Control</h3>
<button class="on" onclick="setAlarm(true)">ðŸ”” à¹€à¸›à¸´à¸” Alarm</button>
<button class="off" onclick="setAlarm(false)">ðŸ”• à¸›à¸´à¸” Alarm</button>
</div>

<script>

var firebaseConfig = {
  apiKey: "AIzaSyDZIwpGy6Zz4pLhejIAfP-EaBKUyXgJwc",
  authDomain: "kjszz-1a818.firebaseapp.com",
  databaseURL: "https://kjszz-1a818-default-rtdb.firebaseio.com",
  projectId: "kjszz-1a818",
  storageBucket: "kjszz-1a818.firebasestorage.app",
  messagingSenderId: "1056726378754",
  appId: "1:1056726378754:web:fe6ae2b60dcda89783a1b"
};

firebase.initializeApp(firebaseConfig);

var db = firebase.database();
let ready=false;

/* login */
firebase.auth().signInAnonymously()
.then(()=>{
  console.log("login success");
  ready=true;
  startRealtime();
})
.catch((error)=>{
  console.log(error);
});

/* realtime */
function startRealtime(){
  db.ref("/sensor").on("value",(snap)=>{
    let d=snap.val();
    if(!d)return;

    document.getElementById("soil").innerHTML=d.soil+" %";
    document.getElementById("temp").innerHTML=d.temperature+" Â°C";
    document.getElementById("alarm").innerHTML=d.alarm?"ON":"OFF";
  });
}

/* control */
function setAlarm(state){
  if(!ready) return alert("Firebase à¸¢à¸±à¸‡à¹„à¸¡à¹ˆ login");
  db.ref("/control/enable").set(state);
}

</script>

</body>
</html>
