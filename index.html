<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>ESP8266 Smart Sensor</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body{font-family:Arial;background:#111;color:white;text-align:center;}
.card{background:#1e1e1e;padding:20px;margin:15px auto;width:300px;border-radius:15px;}
button{padding:10px 20px;margin:5px;border:none;border-radius:10px;font-size:16px;cursor:pointer;}
.on{background:#00c853;color:white;}
.off{background:#d50000;color:white;}
.big{font-size:30px;font-weight:bold;}
</style>
</head>

<body>

<h2>ðŸŒ± Smart Plant Monitor</h2>

<div class="card"><h3>ðŸ’§ Soil</h3><div id="soil" class="big">-- %</div></div>
<div class="card"><h3>ðŸŒ¡ Temperature</h3><div id="temp" class="big">-- Â°C</div></div>
<div class="card"><h3>ðŸš¨ Alarm Status</h3><div id="alarm" class="big">--</div></div>

<div class="card">
<h3>ðŸŽ› Control</h3>
<button class="on" onclick="alarmOn()">ðŸ”Š à¹€à¸›à¸´à¸” Alarm</button>
<button class="off" onclick="alarmOff()">ðŸ”‡ à¸›à¸´à¸” Alarm</button>
</div>

<script>

var firebaseConfig = {
  apiKey: "AIzaSyD2IwpGy6Zz4pLhejIAfP-EAeBKUyXgJwc",
  authDomain: "kjszz-1a818.firebaseapp.com",
  databaseURL: "https://kjszz-1a818-default-rtdb.firebaseio.com",
  projectId: "kjszz-1a818",
  storageBucket: "kjszz-1a818.firebasestorage.app",
  messagingSenderId: "1056726378754",
  appId: "1:1056726378754:web:fea6ee2b60dcda89783a1b"
};


firebase.initializeApp(firebaseConfig);
var db=firebase.database();

let ready=false;

/* â­ login */
firebase.auth().signInAnonymously()
.then(()=>{
console.log("login success");
ready=true;
startRealtime();   // â­ à¹€à¸£à¸´à¹ˆà¸¡à¸­à¹ˆà¸²à¸™à¸„à¹ˆà¸²à¸«à¸¥à¸±à¸‡ login
})
.catch((e)=>{
alert("Firebase login error");
console.log(e);
});

/* control */
function alarmOn(){
if(!ready)return alert("Firebase à¸¢à¸±à¸‡à¹„à¸¡à¹ˆ login");
db.ref("/control/enable").set(true);
}

function alarmOff(){
if(!ready)return alert("Firebase à¸¢à¸±à¸‡à¹„à¸¡à¹ˆ login");
db.ref("/control/enable").set(false);
}

/* realtime */
function startRealtime(){
db.ref("/sensor").on("value",(snap)=>{
let d=snap.val();
if(!d)return;

document.getElementById("soil").innerHTML=d.soil+" %";
document.getElementById("temp").innerHTML=d.temperature+" Â°C";
document.getElementById("alarm").innerHTML=d.alarm?"ON":"OFF";
});
}

</script>
</body>
</html>
